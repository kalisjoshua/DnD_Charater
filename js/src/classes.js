//// classes.js

var Classes = (function () {
    var saves = {
            Cleric: [
            // ppd, pp, rsw, bw, sp
                 [19,19,19,19,19] //  0th level charcter
                ,[10,13,14,16,15] //  1
                ,[10,13,14,16,15] //  2
                ,[10,13,14,16,15] //  3
                ,[09,12,13,15,14] //  4
                ,[09,12,13,15,14] //  5
                ,[09,12,13,15,14] //  6
                ,[07,10,11,13,12] //  7
                ,[07,10,11,13,12] //  8
                ,[07,10,11,13,12] //  9
                ,[06,09,10,12,11] // 10
                ,[06,09,10,12,11] // 11
                ,[06,09,10,12,11] // 12
                ,[05,08,09,11,10] // 13
                ,[05,08,09,11,10] // 14
                ,[05,08,09,11,10] // 15
                ,[04,07,08,10,09] // 16
                ,[04,07,08,10,09] // 17
                ,[04,07,08,10,09] // 18
                ,[02,05,06,08,07] // 19
                ,[02,05,06,08,07] // 20
                ,[02,05,06,08,07] // 21
                ,[01,03,04,06,05] // 22
            ],
            
            Fighter: [
            // ppd, pp, rsw, bw, sp
                 [16,17,18,20,19] //  0th level charcter
                ,[14,15,16,17,17] //  1
                ,[14,15,16,17,17] //  2
                ,[13,14,15,16,16] //  3
                ,[13,14,15,16,16] //  4
                ,[11,12,13,13,14] //  5
                ,[11,12,13,13,14] //  6
                ,[10,11,12,12,13] //  7
                ,[10,11,12,12,13] //  8
                ,[08,09,10,09,11] //  9
                ,[08,09,10,09,11] // 10
                ,[07,08,09,08,10] // 11
                ,[07,08,09,08,10] // 12
                ,[05,06,07,05,08] // 13
                ,[05,06,07,05,08] // 14
                ,[04,05,06,04,07] // 15
                ,[04,05,06,04,07] // 16
                ,[03,04,05,04,06] // 17
                ,[03,04,05,04,06] // 18
                ,[02,03,04,03,05] // 19
                ,[02,03,04,03,05] // 20
                ,[01,02,03,03,04] // 21
                ,[01,02,03,03,04] // 22
            ],
            
            Mage: [
            // ppd, pp, rsw, bw, sp
                 [19,19,19,19,19] //  0th level charcter
                ,[14,13,11,15,12] //  1
                ,[14,13,11,15,12] //  2
                ,[14,13,11,15,12] //  3
                ,[14,13,11,15,12] //  4
                ,[14,13,11,15,12] //  5
                ,[13,11,09,13,10] //  6
                ,[13,11,09,13,10] //  7
                ,[13,11,09,13,10] //  8
                ,[13,11,09,13,10] //  9
                ,[13,11,09,13,10] // 10
                ,[11,09,07,11,08] // 11
                ,[11,09,07,11,08] // 12
                ,[11,09,07,11,08] // 13
                ,[11,09,07,11,08] // 14
                ,[11,09,07,11,08] // 15
                ,[10,07,05,09,06] // 16
                ,[10,07,05,09,06] // 17
                ,[10,07,05,09,06] // 18
                ,[10,07,05,09,06] // 19
                ,[10,07,05,09,06] // 20
                ,[08,05,03,07,04] // 21
                ,[08,05,03,07,04] // 22
            ],
            
            Thief: [
            // ppd, pp, rsw, bw, sp
                 [19,19,19,19,19] //  0th level charcter
                ,[13,12,14,16,15] //  1
                ,[13,12,14,16,15] //  2
                ,[13,12,14,16,15] //  3
                ,[13,12,14,16,15] //  4
                ,[12,11,12,15,13] //  5
                ,[12,11,12,15,13] //  6
                ,[12,11,12,15,13] //  7
                ,[12,11,12,15,13] //  8
                ,[11,10,10,14,11] //  9
                ,[11,10,10,14,11] // 10
                ,[11,10,10,14,11] // 11
                ,[11,10,10,14,11] // 12
                ,[10,09,08,13,09] // 13
                ,[10,09,08,13,09] // 14
                ,[10,09,08,13,09] // 15
                ,[10,09,08,13,09] // 16
                ,[09,08,06,12,07] // 17
                ,[09,08,06,12,07] // 18
                ,[09,08,06,12,07] // 19
                ,[09,08,06,12,07] // 20
                ,[08,07,04,11,05] // 21
                ,[08,07,04,11,05] // 22
            ]
        }
        
        ,thacos = {
             // level    0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22th level character
             Cleric  : [20,20,20,18,18,18,16,16,16,14,14,14,12,12,12,10,10,10,09,09,08,08,07]
            ,Fighter : [20,20,18,18,16,16,14,14,12,12,10,10,08,08,06,06,04,04,04,02,02,01,01]
            ,Mage    : [20,20,20,20,20,19,19,19,19,19,16,16,16,16,16,13,13,13,13,13,11,11,09]
            ,Thief   : [20,20,20,20,19,19,19,19,16,16,16,16,14,14,14,14,12,12,12,12,10,10,08]
        }
    
        ,list = [
            {
                name: "Acrobat",
                dual: [],
                HDT: 6,
                prefs: [3,4,0,1,5,2,6],
                saves: saves.Thief,
                thaco: thacos.Thief
            },

            {
                name: "Archer",
                dual: [],
                HDT: 8,
                prefs: [3,0,4,2,1,5,6],
                saves: saves.Cleric,
                thaco: thacos.Cleric
            },

            {
                name: "Assassin",
                dual: [],
                HDT: 6,
                prefs: [5,3,1,4,0,2,6],
                saves: saves.Thief,
                thaco: thacos.Thief
            },

            {
                name: "Barbarian",
                dual: [],
                HDT: 12,
                prefs: [0,4,3,5,1,6,2],
                saves: saves.Fighter,
                thaco: thacos.Fighter
            },

            {
                name: "Bard",
                dual: [],
                HDT: 12,
                prefs: [5,0,1,4,3,6,2],
                saves: saves.Fighter,
                spells: [
                //   1 2 3 4 5 6 7  Spell level
                    [0,0,0,0,0,0,0], //  0th level character
                    [0,0,0,0,0,0,0], //  1
                    [0,0,0,0,0,0,0], //  2
                    [0,0,0,0,0,0,0], //  3
                    [0,0,0,0,0,0,0], //  4
                    [0,0,0,0,0,0,0], //  5
                    [0,0,0,0,0,0,0], //  6
                    [0,0,0,0,0,0,0], //  7
                    [0,0,0,0,0,0,0], //  8
                    [0,0,0,0,0,0,0], //  9
                    [0,0,0,0,0,0,0], // 10
                    [0,0,0,0,0,0,0], // 11
                    [0,0,0,0,0,0,0], // 12
                    [0,0,0,0,0,0,0], // 13
                    [0,0,0,0,0,0,0], // 14
                    [0,0,0,0,0,0,0], // 15
                    [0,0,0,0,0,0,0], // 16
                    [0,0,0,0,0,0,0], // 17
                    [0,0,0,0,0,0,0], // 18
                    [0,0,0,0,0,0,0], // 19
                    [0,0,0,0,0,0,0], // 20
                    [0,0,0,0,0,0,0], // 21
                    [0,0,0,0,0,0,0], // 22
                    [0,0,0,0,0,0,0], // 23
                    [0,0,0,0,0,0,0], // 24
                    [0,0,0,0,0,0,0], // 25
                    [0,0,0,0,0,0,0], // 26
                    [0,0,0,0,0,0,0], // 27
                    [0,0,0,0,0,0,0], // 28
                    [0,0,0,0,0,0,0]  // 29
                    // TODO: fill out these values...?
                ],
                thaco: thacos.Fighter
            },

            {
                name: "Cavalier",
                dual: [],
                HDT: 10,
                prefs: [0,3,4,1,5,6,2],
                saves: saves.Fighter,
                thaco: thacos.Fighter
            },

            {
                name: "Cleric",
                dual: [
                    "Fighter",
                    "Illusionist",
                    "Mage",
                    "Thief"
                ],
                HDT: 8,
                prefs: [2,4,0,3,1,5,6],
                saves: saves.Cleric,
                spells: [
                //   1 2 3 4 5 6 7  Spell level
                    [0,0,0,0,0,0,0], //  0th level character
                    [1,0,0,0,0,0,0], //  1
                    [2,0,0,0,0,0,0], //  2
                    [2,1,0,0,0,0,0], //  3
                    [3,2,0,0,0,0,0], //  4
                    [3,3,1,0,0,0,0], //  5
                    [1,3,2,0,0,0,0], //  6
                    [1,3,2,1,0,0,0], //  7
                    [3,3,3,2,0,0,0], //  8
                    [4,4,3,2,1,0,0], //  9
                    [4,4,3,3,2,0,0], // 10
                    [5,4,4,3,2,1,0], // 11
                    [6,5,5,3,2,2,0], // 12
                    [6,6,6,4,2,2,0], // 13
                    [6,6,6,5,3,2,0], // 14
                    [7,7,7,5,4,2,0], // 15
                    [7,7,7,6,5,3,1], // 16
                    [8,8,8,6,5,3,1], // 17
                    [8,8,8,7,6,4,1], // 18
                    [9,9,9,7,6,4,2], // 19
                    [9,9,9,8,7,5,2], // 20
                    [9,9,9,9,8,6,2], // 21
                    [9,9,9,9,9,6,3], // 22
                    [9,9,9,9,9,7,3], // 23
                    [9,9,9,9,9,8,3], // 24
                    [9,9,9,9,9,8,4], // 25
                    [9,9,9,9,9,9,4], // 26
                    [9,9,9,9,9,9,5], // 27
                    [9,9,9,9,9,9,6], // 28
                    [9,9,9,9,9,9,7]  // 29
                ],
                thaco: thacos.Cleric
            },

            {
                name: "Druid",
                dual: [
                    "Fighter",
                    "Illusionist",
                    "Mage",
                    "Thief"
                ],
                HDT: 8,
                prefs: [2,5,3,4,1,0,6],
                saves: saves.Cleric,
                spells: [
                //   1 2 3 4 5 6 7  Spell level
                    [0,0,0,0,0,0,0], //  0th level character
                    [2,0,0,0,0,0,0], //  1
                    [2,1,0,0,0,0,0], //  2
                    [3,2,1,0,0,0,0], //  3
                    [4,2,2,0,0,0,0], //  4
                    [4,3,2,0,0,0,0], //  5
                    [4,3,2,1,0,0,0], //  6
                    [4,4,3,1,0,0,0], //  7
                    [4,4,3,2,0,0,0], //  8
                    [5,4,3,2,1,0,0], //  9
                    [5,4,3,3,2,0,0], // 10
                    [5,5,3,3,2,1,0], // 11
                    [5,5,4,4,3,2,1], // 12
                    [6,5,5,5,4,3,2], // 13
                    [6,5,6,5,4,3,3], // 14
                    [6,6,6,5,4,3,3], // 15 
                    [6,6,6,5,4,3,3], // 16
                    [7,6,6,6,4,3,3], // 17
                    [7,6,6,6,5,4,4], // 18
                    [7,7,6,6,5,4,4], // 19
                    [7,7,6,6,5,4,4], // 20
                    [8,7,7,7,5,4,4], // 21
                    [8,7,7,7,5,4,4], // 22
                    [8,8,7,7,6,5,4], // 23
                    [8,8,8,7,6,5,4], // 24
                    [9,8,8,7,6,5,4], // 25
                    [9,8,8,8,6,5,4], // 26
                    [9,9,8,8,6,5,5], // 27
                    [9,9,8,8,7,6,5], // 28
                    [9,9,9,9,7,6,6]  // 29
                ],
                thaco: thacos.Cleric
            },

            {
                name: "Fighter",
                dual: [
                    "Cleric",
                    "Druid",
                    "Illusionist",
                    "Mage",
                    "Thief"
                ],
                HDT: 10,
                prefs: [0,4,3,5,6,1,2],
                saves: saves.Fighter,
                thaco: thacos.Fighter
            },

            {
                name: "Illusionist",
                dual: [
                    "Cleric",
                    "Druid",
                    "Fighter",
                    "Thief"
                ],
                HDT: 4,
                prefs: [1,3,6,5,4,2,0],
                saves: saves.Mage,
                spells: [
                //   1 2 3 4 5 6 7  Spell level
                    [0,0,0,0,0,0,0], //  0th level character
                    [1,0,0,0,0,0,0], //  1
                    [2,0,0,0,0,0,0], //  2
                    [2,1,0,0,0,0,0], //  3
                    [3,2,0,0,0,0,0], //  4
                    [4,2,1,0,0,0,0], //  5
                    [4,3,1,0,0,0,0], //  6
                    [4,3,2,0,0,0,0], //  7
                    [4,3,2,1,0,0,0], //  8
                    [4,3,3,2,0,0,0], //  9
                    [5,4,3,2,1,0,0], // 10
                    [5,4,4,3,2,0,0], // 11
                    [5,5,4,3,2,1,0], // 12
                    [5,5,4,3,2,2,0], // 13
                    [5,5,4,3,2,2,1], // 14
                    [5,5,5,4,2,2,2], // 15
                    [5,5,5,4,3,2,2], // 16
                    [5,5,5,5,3,2,2], // 17
                    [5,5,5,5,3,3,2], // 18
                    [5,5,5,5,4,3,2], // 19
                    [5,5,5,5,4,3,3], // 20
                    [5,5,5,5,5,4,3], // 21
                    [5,5,5,5,5,5,4], // 22
                    [5,5,5,5,5,5,5], // 23
                    [6,6,6,6,5,5,5], // 24
                    [6,6,6,6,6,6,6], // 25
                    [7,7,7,7,6,6,6], // 26
                    [8,7,7,7,6,6,6], // 27
                    [9,8,7,7,6,6,6], // 28
                    [9,9,9,7,7,7,7]  // 29
                ],
                thaco: thacos.Mage
            },

            {
                name: "Mage",
                dual: [
                    "Cleric",
                    "Druid",
                    "Fighter",
                    "Thief"
                ],
                HDT: 4,
                prefs: [1,3,5,2,4,6,0],
                saves: saves.Mage,
                spells: [
                //   1 2 3 4 5 6 7 8 9  Spell level
                    [0,0,0,0,0,0,0,0,0], //  0th level character
                    [1,0,0,0,0,0,0,0,0], //  1
                    [2,0,0,0,0,0,0,0,0], //  2
                    [2,1,0,0,0,0,0,0,0], //  3
                    [3,2,0,0,0,0,0,0,0], //  4
                    [4,2,1,0,0,0,0,0,0], //  5
                    [4,2,2,0,0,0,0,0,0], //  6
                    [4,3,2,1,0,0,0,0,0], //  7
                    [4,3,3,2,0,0,0,0,0], //  8
                    [4,3,3,2,1,0,0,0,0], //  9
                    [4,4,3,2,2,0,0,0,0], // 10
                    [4,4,4,3,3,0,0,0,0], // 11
                    [4,4,4,4,4,1,0,0,0], // 12
                    [5,5,5,4,4,2,0,0,0], // 13
                    [5,5,5,4,4,2,1,0,0], // 14
                    [5,5,5,5,5,2,1,0,0], // 15
                    [5,5,5,5,5,3,2,1,0], // 16
                    [5,5,5,5,5,3,3,2,0], // 17
                    [5,5,5,5,5,3,3,2,1], // 18
                    [5,5,5,5,5,3,3,3,1], // 19
                    [5,5,5,5,5,4,3,3,2], // 20
                    [5,5,5,5,5,4,4,4,2], // 21
                    [5,5,5,5,5,5,4,4,3], // 22
                    [5,5,5,5,5,5,5,5,3], // 23
                    [5,5,5,5,5,5,5,5,4], // 24
                    [5,5,5,5,5,5,5,5,5], // 25
                    [6,6,6,6,5,5,5,5,5], // 26
                    [6,6,6,6,6,6,6,5,5], // 27
                    [6,6,6,6,6,6,6,6,6], // 28
                    [7,7,7,7,6,6,6,6,6]  // 29
                ],
                thaco: thacos.Mage
            },

            {
                name: "Monk",
                dual: [],
                HDT: 4,
                prefs: [3,4,2,1,0,5,6],
                saves: saves.Thief,
                thaco: thacos.Cleric
            },

            {
                name: "Paladin",
                dual: [],
                HDT: 10,
                prefs: [0,4,3,5,1,6,2],
                saves: saves.Fighter,
                spells: [
                //   1 2 3 4  Spell level
                    [0,0,0,0], //  0th level character
                    [0,0,0,0], //  1
                    [0,0,0,0], //  2
                    [0,0,0,0], //  3
                    [0,0,0,0], //  4
                    [0,0,0,0], //  5
                    [0,0,0,0], //  6
                    [0,0,0,0], //  7
                    [0,0,0,0], //  8
                    [1,0,0,0], //  9
                    [2,0,0,0], // 10
                    [2,1,0,0], // 11
                    [2,2,0,0], // 12
                    [2,2,1,0], // 13
                    [3,2,1,0], // 14
                    [3,2,1,1], // 15
                    [3,3,1,1], // 16
                    [3,3,2,1], // 17
                    [3,3,3,1], // 18
                    [4,3,3,2], // 19
                    [4,3,3,3], // 20
                    [4,3,3,3], // 21
                    [4,4,3,3], // 22
                    [4,4,3,3], // 23
                    [5,4,4,3], // 24
                    [5,4,4,3], // 25
                    [5,4,4,3], // 26
                    [5,5,5,4], // 27
                    [5,5,5,4], // 28
                    [6,5,5,4]  // 29
                ],
                thaco: thacos.Fighter
            },

            {
                name: "Ranger",
                dual: [],
                HDT: 10,
                prefs: [0,4,3,2,5,6,1],
                saves: saves.Fighter,
                spells: [
                //   1 2 3 4 5  Spell level
                    [0,0,0,0,0], //  0th level character
                    [0,0,0,0,0], //  1
                    [0,0,0,0,0], //  2
                    [0,0,0,0,0], //  3
                    [0,0,0,0,0], //  4
                    [0,0,0,0,0], //  5
                    [0,0,0,0,0], //  6
                    [0,0,0,0,0], //  7
                    [1,0,0,0,0], //  8
                    [1,0,0,1,0], //  9
                    [2,0,0,1,0], // 10
                    [2,0,0,2,0], // 11
                    [2,1,0,2,0], // 12
                    [2,1,0,2,1], // 13
                    [2,2,0,2,1], // 14
                    [2,2,0,2,2], // 15
                    [2,2,1,2,2], // 16
                    [3,2,2,2,2], // 17
                    [3,2,2,2,2], // 18
                    [3,2,2,2,2], // 19
                    [3,3,2,2,2], // 20
                    [3,3,2,2,2], // 21
                    [3,3,2,2,2], // 22
                    [3,3,3,2,2], // 23
                    [3,3,3,2,2], // 24
                    [4,3,3,2,2], // 25
                    [4,4,3,3,2], // 26
                    [4,4,4,3,2], // 27
                    [4,4,4,3,2], // 28
                    [5,4,4,4,3]  // 29
                ],
                thaco: thacos.Fighter
            },

            {
                name: "Thief",
                dual: [
                    "Cleric",
                    "Fighter",
                    "Druid",
                    "Illusionist",
                    "Mage"
                ],
                HDT: 6,
                prefs: [3,1,5,4,0,2,6],
                saves: saves.Thief,
                thaco: thacos.Thief
            }
        ];

    return augment(list, {
            dual: function () {
                return this.filter(function (node) {
                    return node.dual.length > 1;
                });
            }

            ,merge: function (_a, _b) {
                if (_a === _b || _b === undefined || _a === undefined || !Classes.is(_a) || !Classes.is(_b)) {
                    throw new Error("Invalid arguments passed to Classes.merge(): " + [_a, _b]);
                }
                _a = Classes.is(_a);
                _b = Classes.is(_b);

                return {
                         name: _a.name + "/" + _b.name

                        ,HDT: (_a.HDT + _b.HDT) / 2

                        ,prefs: (function (a, b) {
                            var  i = 0
                                ,l = a.length
                                ,result = [];

                            for ( ; i < l; i++) {
                                result.indexOf(a[i]) === -1 && result.push(a[i]);
                                result.indexOf(b[i]) === -1 && result.push(b[i]);
                            }

                            return result;
                        }(_a.prefs, _b.prefs))

                        ,saves: (function (a, b) {
                            var level = [],
                                result = [];

                            while (result.length < a.length) {
                                level = [];

                                while (level.length < a[0].length) {
                                    level.push(a[result.length][level.length] < b[result.length][level.length] ? a[result.length][level.length] : b[result.length][level.length]);
                                }

                                result.push(level);
                            }

                            return result;
                        }(_a.saves, _b.saves))

                        ,spells: (function (a, b) {
                            if (a || b) {
                                return [a, b];
                            }
                        }(_a.spells, _b.spells))

                        ,thaco: (function (a, b) {
                            var indx = 0,
                                result = [];

                            while (indx < a.length) {
                                result.push(a[indx] < b[indx] ? a[indx] : b[indx]);
                                indx++;
                            }

                            return result;
                        }(_a.thaco, _b.thaco))
                    };
            }
        }).
        each(function (node) {
            node.getType = function () {
                return "[object Class-" + this.name + "]";
            }
        });
}());
